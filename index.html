<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Proof-Easy｜簡易校正ツール</title>
  <link rel="stylesheet" href="style.css">
  <!-- ライブラリ読み込み -->
  <!-- ✅ PDF.js 本体と Worker を 3.4.120 に統一 -->
  <link rel="icon" href="favicon.png" type="image/png">
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.4.120/build/pdf.min.js"></script>
  <script>
    pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.4.120/build/pdf.worker.min.js';
  </script>

  <!-- ✅ Excel & OCR -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.1/dist/tesseract.min.js"></script>

</head>

<body>
  <h1>📘 コウセイくん | 簡易校正ツール</h1>

  <div class="section">
    <label>モード選択：</label>
    <label><input type="checkbox" id="modeA" checked /> A：売価・数量チェック</label>
    <label><input type="checkbox" id="modeB" checked /> B：テキスト差分チェック</label>
  </div>

  <!-- 厳密／ゆるめ モード切り替え -->
  <div style="margin-top: 1em;">
    <label><input type="radio" name="matchMode" value="strict" checked> 🔍 厳密モード</label>
    <label><input type="radio" name="matchMode" value="loose"> 🎈 ゆるめモード</label>
    <p style="font-size: 0.9em; color: gray; margin-left: 1em;">
      ※ゆるめモードは空白や改行の差を無視して比較します
    </p>
  </div>

  <!-- ▼ 1. 形式・OCRの選択をファイル選択の前に移動 -->
  <div class="form-group">
    <label>原稿の形式を選択：</label>
    <label><input type="radio" name="sourceMode" value="pdf" checked> PDF</label>
    <label><input type="radio" name="sourceMode" value="excel"> Excel</label>
    <label><input type="checkbox" id="useOCR"> OCRを使う（PDFのみ）</label>
  </div>

  <!-- ▼ 2. ファイルアップロード（その下に） -->
  <div class="form-group">
    <label for="sourceFile">原稿データ選択：</label>
    <input type="file" id="sourceFile">
  </div>

  <div class="section">
    <label>完成デザイン（PDF）を選択：</label>
    <input type="file" id="designPDF" accept=".pdf" />
  </div>

 <div class="section two-column">
  <div class="half">
    <label>原稿テキスト</label>
    <textarea id="sourceText" rows="8" placeholder="原稿のテキストがここに表示されます"></textarea>
  </div>
  <div class="half">
    <label>完成デザインテキスト</label>
    <textarea id="designText" rows="8" placeholder="完成デザインのテキストがここに表示されます"></textarea>
  </div>
</div>

  <div class="section">
    <label>デザイン内に含まれる原稿ワードの可視化</label>
    <div id="designPreview" class="preview-box"></div>
  </div>


  <div class="result-section"></div>

  <!-- ▼ 3. 「チェック」ボタンの隣に「クリア」ボタン追加 -->
  <div class="form-group">
    <button onclick="runCheck()">チェックする</button>
    <button onclick="clearAll()">クリア</button>
  </div>

  <div id="result" class="result"></div>

  <canvas id="hiddenCanvas" style="display:none;"></canvas>

  <script src="script.js"></script>
</body>

</html>